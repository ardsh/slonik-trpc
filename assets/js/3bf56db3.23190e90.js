"use strict";(self.webpackChunkslonik_trpc_docs=self.webpackChunkslonik_trpc_docs||[]).push([[607],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>g});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=n.createContext({}),u=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=u(r),m=o,g=p["".concat(l,".").concat(m)]||p[m]||d[m]||a;return r?n.createElement(g,s(s({ref:t},c),{},{components:r})):n.createElement(g,s({ref:t},c))}));function g(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,s=new Array(a);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[p]="string"==typeof e?e:o,s[1]=i;for(var u=2;u<a;u++)s[u]=r[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},1284:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>u});var n=r(7462),o=(r(7294),r(3905));const a={sidebar_position:13},s="Sorting",i={unversionedId:"usage-main-features/sorting",id:"usage-main-features/sorting",title:"Sorting",description:"To add sorting to your data, you can use the sortableColumns option. This allows you to specify the columns that can be sorted, along with their corresponding sorting expressions. For example:",source:"@site/docs/usage-main-features/sorting.md",sourceDirName:"usage-main-features",slug:"/usage-main-features/sorting",permalink:"/slonik-trpc/docs/usage-main-features/sorting",draft:!1,editUrl:"https://github.com/ardsh/slonik-trpc/tree/main/docs/docs/usage-main-features/sorting.md",tags:[],version:"current",sidebarPosition:13,frontMatter:{sidebar_position:13},sidebar:"tutorialSidebar",previous:{title:"Virtual fields",permalink:"/slonik-trpc/docs/usage-main-features/virtual-columns"},next:{title:"Cursor-based pagination",permalink:"/slonik-trpc/docs/usage-main-features/cursor-pagination"}},l={},u=[{value:"Transforming sorting",id:"transforming-sorting",level:3}],c={toc:u};function p(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"sorting"},"Sorting"),(0,o.kt)("p",null,"To add sorting to your data, you can use the sortableColumns option. This allows you to specify the columns that can be sorted, along with their corresponding sorting expressions. For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'const postsLoader = makeQueryLoader({\n    db,\n    query,\n    sortableColumns: {\n        name: sql.fragment`users.first_name || users.last_name`,\n        id: ["posts", "id"],\n        date: ["posts", "created_at"],\n        title: "title",\n    },\n});\n')),(0,o.kt)("p",null,"Now you can use these aliases in the orderBy. For example, to sort the posts by name and date:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'const sortedByName = await postsLoader.load({\n    orderBy: ["name", "ASC"],\n}));\n\nconst sortedByNameAndDate = await postsLoader.load({\n    orderBy: [["name", "DESC"], ["date", "ASC"]],\n    take: 5,\n}))\n')),(0,o.kt)("h3",{id:"transforming-sorting"},"Transforming sorting"),(0,o.kt)("p",null,"You can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"transformSortColumns")," function in the ",(0,o.kt)("inlineCode",{parentName:"p"},"getLoadArgs()")," call to transform the orderBy array."),(0,o.kt)("p",null,"For example, to add a tie-breaker column to the sorting, you can use the following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="postsRouter.ts"',title:'"postsRouter.ts"'},'getPosts: publicProcedure\n    .input(postsLoader.getLoadArgs({\n        transformSortColumns(columns) {\n            // Adds id ASC at the end as a tie-breaker\n            return [...columns, ["id", "ASC"]];\n        }\n    }))\n    .query(({ input, ctx }) => {\n        return postsLoader.loadPagination({\n            ...input,\n            // Complete overwriting is also possible...\n            orderBy: input.orderBy || ["id", "ASC"],\n            ctx,\n        });\n    }),\n')),(0,o.kt)("p",null,"This will add the id column in ascending order as a tie-breaker to the sorting, ensuring that the results are always sorted consistently."),(0,o.kt)("p",null,"Sortable columns are necessary for ",(0,o.kt)("a",{parentName:"p",href:"/slonik-trpc/docs/usage-main-features/cursor-pagination"},"cursor-based pagination")," to work."),(0,o.kt)("p",null,"If you do not specify any sortableColumns, your API will not be sortable with orderBy. Only columns that are specified in sortableColumns are allowed to be used in orderBy."))}p.isMDXComponent=!0}}]);